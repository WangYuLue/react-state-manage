# React 状态管理工具调研

## 工具

### 原生 props

项目越大，写起来越难受，会有 `props drilling` 问题。

### 原生 context

写起来很方便，但是项目一大会哟性能问题，每一次对 props 的变更都会引起全局的渲染。

可以用 memo 解决一部分性能问题。

### redux

社区用的最多的状态管理工具，概念很多，样本代码也很多。

写起来很麻烦，要定义 action、reducer，还要通过 dispatch 来触发更新，啰里八嗦的。

然后缺乏计算属性的功能，项目一大计算属性很有必要，可惜 redux 没有。

官方为了减少 redux 的复杂和样板代码还推出了 redux-toolkit，但是看了一样文档感觉这玩意是个四不像，不像传统的 redux，上手感觉还是很麻烦，果断跑路了。

### rxjs

JS 领域的神器，基本可以完成状态管理中的所有功能：

- 细粒度 render
- 计算属性
- 异步
- 非 react 上下文订阅和更新

不过 rxjs 并不是专业做 状态管理的，所以当作状态管理工具来用样板代码比较多。

而且 rxjs 概念很多、操作符很多，变更比较激烈，学习路径相对陡峭。

所以总结是：rxjs 可以实现 状态管理 的需求，但不是最合适的选择。就像坦克可以带客，但总没有打巴来的舒服。

### mobx

大道至简！

mobx 用起来最为简单，类的属性是 Observable，类的 get 方法是 Computed，类的 函数是 Action；一切都是自然而然。

再用 observer 把组件包一下，切都是相应式的变更了。连 memo 都不要了，observer 会自动 memo，只 render 真正需要 render 的地方。

### zustand

最近社区推崇的比较火，用起来比 redux 方便多了。但是 store 的定义比较怪异，不太适应。

还有个缺点是不支持计算属性。

### jotai

难用，有设计缺陷：

- 处理异步时很麻烦
- 无法在非 react 上下问中使用

优点是支持计算属性，但是瑜不掩瑕。

### recoil

更难用，还是官方维护的，感觉有点走火入魔了：

- 定义 atom 还要设置一个 key, 反人类设计
- 和 react、 react-dom 强绑定，不愧是官方出品（意味着无法在非 react 上下问中使用）

### [xstate](https://xstate.js.org/docs/zh/about/concepts.html#%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA)

使用有限状态机来进行状态管理。

个人认为其不适用用 UI 上的状态管理，而更适用于对于复杂业务逻辑的状态管理。

比如电商中订单的状态有：【待付款】、【待发货】、【待收货】、【待评价】、【交易完成】、【用户取消】、【仅退款】、【退货退款】。

这些状态中每个状态又都可以通过某些 action 进行状态转移，如果放在一般的编程中，需要写大量的 if-else 代码，造成维护困难。这时候可以通过有限状态机来维护这些状态，并通过可视化工具清晰的看到状态的转移路径。
